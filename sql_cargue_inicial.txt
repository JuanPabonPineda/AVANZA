## CREACIÓN DE BASE DE DATOS
CREATE DATABASE `avanza_db` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_bin */;
CREATE USER 'root' IDENTIFIED BY 'micuentamysql';
GRANT ALL PRIVILEGES ON avanza_db.* TO 'root';

-- avanza_db.users definition
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `first_name` varchar(200) DEFAULT NULL,
  `last_name` varchar(200) DEFAULT NULL,
  `username` varchar(100) DEFAULT NULL,
  `password` varchar(200) DEFAULT NULL,
  `role` varchar(100) DEFAULT NULL,
  `position` varchar(100) DEFAULT NULL,
  `creation_date` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=46 DEFAULT CHARSET=utf8mb4;
INSERT INTO avanza_db.users
(id, first_name, last_name, username, password, `role`, `position`, creation_date)
VALUES(46, 'Admin', 'Admin', 'Admin', '1234', 'Admin', 'Admin', NULL);

-- avanza_db.clients definition
CREATE TABLE `clients` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `number` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `name` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `creation_date` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

-- avanza_db.products definition
CREATE TABLE `products` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `reference` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `brand` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `price` bigint(20) DEFAULT NULL,
  `category` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `stocks` bigint(20) DEFAULT NULL,
  `creation_date` datetime DEFAULT NULL,
  `modification_date` datetime DEFAULT NULL,
  `discount` int(11) DEFAULT NULL,
  `status` tinyint(1) DEFAULT 1,
  `code` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `products_un` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

-- avanza_db.billing definition

CREATE TABLE `billing` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `invoice_number` bigint(20) NOT NULL,
  `user` int(11) NOT NULL,
  `client` int(11) NOT NULL,
  `total_price` bigint(20) DEFAULT NULL,
  `payment_type` int(11) DEFAULT NULL,
  `status` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `invoice_un` (`invoice_number`),
  KEY `FK_billing_users` (`user`),
  KEY `FK_billing_client` (`client`),
  CONSTRAINT `FK_billing_client` FOREIGN KEY (`client`) REFERENCES `clients` (`id`),
  CONSTRAINT `FK_billing_users` FOREIGN KEY (`user`) REFERENCES `users` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=81 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

-- avanza_db.product_detail definition

CREATE TABLE `product_detail` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `product_code` varchar(100) COLLATE utf8_bin NOT NULL,
  `count` int(11) NOT NULL,
  `total_price` bigint(20) NOT NULL,
  `invoice_number` bigint(20) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `product_detail_products_FK` (`product_code`),
  KEY `invoice_FK` (`invoice_number`),
  CONSTRAINT `invoice_FK` FOREIGN KEY (`invoice_number`) REFERENCES `billing` (`invoice_number`),
  CONSTRAINT `product_detail_products_FK` FOREIGN KEY (`product_code`) REFERENCES `products` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=99 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

-- avanza_db.resources definition

CREATE TABLE `resources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `out_int` tinyint(1) NOT NULL COMMENT '1 ingreso, 0 salida',
  `category` varchar(100) COLLATE utf8_bin DEFAULT NULL,
  `creation_date` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `amount` bigint(20) NOT NULL COMMENT 'Monto de la transacción',
  `user_id` int(11) NOT NULL COMMENT 'Usuario que registra la transacción',
  `billing_id` bigint(20) DEFAULT NULL,
  `current_resources` bigint(20) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `FK_resources_users` (`user_id`),
  KEY `FK_resources_billing` (`billing_id`),
  CONSTRAINT `FK_resources_billing` FOREIGN KEY (`billing_id`) REFERENCES `billing` (`id`),
  CONSTRAINT `FK_resources_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8 COLLATE=utf8_bin;




